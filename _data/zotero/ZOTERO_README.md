# Zotero Publications Pipeline

Automatically fetch publications from your Zotero collection and render them on GitHub Pages.

## Overview

This project provides two ways to fetch publications from Zotero and export them as YAML for Jekyll GitHub Pages:

1. **Jupyter Notebook** (`zotero_publications_pipeline.ipynb`) — Interactive, for manual runs and exploration
2. **Python Script** (`fetch_zotero_publications.py`) — Standalone, for automation and GitHub Actions

Both approaches:
- Fetch publications from your Zotero collection via API
- Clean and standardize metadata (titles, authors, dates, etc.)
- Assign geographic regions based on title keywords
- Export as YAML for Jekyll rendering

## Quick Start

### Option 1: Run Locally

**Prerequisites:**
```bash
pip install requests pyyaml
```

**Get your Zotero credentials:**
1. Go to https://www.zotero.org/settings/keys and create an API key
2. Find your Group ID and Collection Key in your Zotero account

**Run the script:**
```bash
python fetch_zotero_publications.py \
  --api-key YOUR_API_KEY \
  --group-id YOUR_GROUP_ID \
  --collection-key YOUR_COLLECTION_KEY \
  --output-dir ./output
```

Or with environment variables:
```bash
export ZOTERO_API_KEY="your_api_key"
export ZOTERO_GROUP_ID="your_group_id"
export ZOTERO_COLLECTION_KEY="your_collection_key"
python fetch_zotero_publications.py
```

### Option 2: Use the Jupyter Notebook

```bash
jupyter notebook zotero_publications_pipeline.ipynb
```

Update the credentials in Step 2, then run all cells sequentially.

### Option 3: GitHub Actions (Recommended for Automation)

Set up automatic updates to your GitHub Pages site:

**Step 1: Add secrets to your repository**
1. Go to Settings → Secrets and Variables → Actions
2. Create three repository secrets:
   - `ZOTERO_API_KEY` — Your API key
   - `ZOTERO_GROUP_ID` — Your group ID (e.g., "REDACTED_GROUP_ID")
   - `ZOTERO_COLLECTION_KEY` — Your collection key (e.g., "VD8Z582Z")

**Step 2: Add the workflow file**
1. Copy `.github/workflows/update-publications.yml` to your repository
2. Update the schedule if you want a different frequency (default: daily at 2 AM UTC)

**Step 3: Create the _data folder**
If your repo doesn't have a `_data` folder, create it:
```bash
mkdir -p _data
```

**Step 4: Push to GitHub**
The workflow will automatically run and update `_data/filtered_pifsc_publications.yml`

## Output Files

The script generates three output files:

- **`filtered_pifsc_publications.yml`** ← Use this for Jekyll (copy to `_data/`)
- `filtered_pifsc_publications.json` — For debugging and reference
- `filtered_pifsc_publications.csv` — For spreadsheet editing

## Region Classification

Publications are automatically classified by region based on title keywords:

- **Hawaiian Archipelago** — hawaii, maui, kauai, oahu, etc.
- **American Samoa** — samoa, aua, swains island
- **Mariana Archipelago** — guam, mariana, saipan
- **Pacific Remote Island Areas** — wake, palmyra, jarvis, etc.
- **Pacific-wide** — general Pacific studies
- **Unknown** — unclassified

Customize region keywords in the `assign_region()` function.

## Jekyll Integration

Your Jekyll template (`_layouts/publications.html`) will automatically load the YAML:

```liquid
{% for pub in site.data.filtered_pifsc_publications %}
  <tr>
    <td>{{ pub.title }}</td>
    <td>{{ pub.creators }}</td>
    <td>{{ pub.year }}</td>
    <td>{{ pub.region }}</td>
    ...
  </tr>
{% endfor %}
```

## File Structure

```
your-repo/
├── _data/
│   └── filtered_pifsc_publications.yml  ← Generated by script/workflow
├── _layouts/
│   └── publications.html
├── .github/
│   └── workflows/
│       └── update-publications.yml      ← GitHub Actions workflow
├── fetch_zotero_publications.py         ← Standalone Python script
└── zotero_publications_pipeline.ipynb   ← Jupyter notebook
```

## Troubleshooting

**API key not working?**
- Verify the key at https://www.zotero.org/settings/keys
- Ensure the group ID and collection key are correct

**No publications being fetched?**
- Check that your collection is public or that you have API access
- Verify the collection key matches your Zotero account

**GitHub Actions failing?**
- Check the workflow logs: Settings → Actions → Update Zotero Publications
- Verify repository secrets are set correctly
- Ensure the script can access the network (not blocked by firewall)

**Duplicate publications?**
- Check your Zotero collection for duplicates and remove them
- The script will automatically skip duplicates based on title

## Customization

### Change update frequency
Edit `.github/workflows/update-publications.yml`:
```yaml
schedule:
  - cron: '0 2 * * *'  # Change this cron expression
```

Common patterns:
- `'0 2 * * *'` — Daily at 2 AM UTC
- `'0 */6 * * *'` — Every 6 hours
- `'0 0 * * 0'` — Weekly (Sunday at midnight UTC)

### Add more fields to export
Edit the publication record in `process_publications()`:
```python
pub = {
    "title": title,
    "creators": clean_creators(data.get("creators", [])),
    "year": extract_year(data.get("date", "")),
    # Add more fields here
    "abstract": data.get("abstractNote", ""),
    "keywords": data.get("tags", []),
}
```

### Filter publications by criteria
Add filtering logic in `process_publications()`:
```python
# Skip publications before 2015
if pub["year"] and pub["year"] < 2015:
    continue
```

## Security Notes

- **Never commit API keys to version control**
- Use GitHub repository secrets for sensitive data
- The script accepts credentials via environment variables or command-line arguments
- For local use, consider using `.env` files with a tool like `python-dotenv`

## Support

For issues or questions:
1. Check the troubleshooting section above
2. Review the Zotero API documentation: https://www.zotero.org/support/dev/web_api
3. Check GitHub Actions logs for detailed error messages

## License

This project is provided as-is for use with your Zotero collection.
